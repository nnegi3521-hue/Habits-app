<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HabitTick - Complete Habit Tracking, Goals & Analytics Platform">
    <meta name="theme-color" content="#06b6d4">
    <title>HabitTick v7 - Habit Tracking + Goals + Analytics</title>
    <style>
        :root {
            --color-bg-primary: #fafaf9;
            --color-bg-secondary: #f5f5f5;
            --color-surface: #ffffff;
            --color-text-primary: #1f2937;
            --color-text-secondary: #6b7280;
            --color-border: #e5e7eb;
            --color-primary: #06b6d4;
            --color-primary-hover: #0891b2;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
            --color-accent: #8b5cf6;
            --color-admin: #7c3aed;
            --radius: 12px;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --duration: 250ms;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            line-height: 1.6;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 16px; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: all var(--duration); font-size: 14px; }
        .btn-primary { background: var(--color-primary); color: white; }
        .btn-primary:hover { background: var(--color-primary-hover); transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .btn-secondary { background: var(--color-bg-secondary); color: var(--color-text-primary); border: 1px solid var(--color-border); }
        .btn-secondary:hover { background: var(--color-border); }
        .btn-danger { background: var(--color-error); color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-small { padding: 6px 12px; font-size: 12px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .card { background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow-sm); transition: box-shadow var(--duration); }
        .card:hover { box-shadow: var(--shadow-md); }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; animation: fadeIn 0.3s; }
        .modal.active { display: flex; }
        .modal-content { background: var(--color-surface); border-radius: var(--radius); padding: 24px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); animation: slideUp 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--color-text-primary); }
        .form-input { width: 100%; padding: 10px 12px; border: 1px solid var(--color-border); border-radius: 8px; background: var(--color-surface); color: var(--color-text-primary); font-size: 14px; transition: border-color var(--duration); }
        .form-input:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1); }
        .grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .stat-card { background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius); padding: 20px; text-align: center; transition: all var(--duration); }
        .stat-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        .stat-value { font-size: 32px; font-weight: 700; color: var(--color-primary); margin: 8px 0; }
        .stat-label { font-size: 12px; color: var(--color-text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .header { background: var(--color-surface); border-bottom: 1px solid var(--color-border); padding: 16px 0; position: sticky; top: 0; z-index: 100; box-shadow: var(--shadow-sm); }
        .header-content { display: flex; justify-content: space-between; align-items: center; padding: 0 16px; }
        .nav-tabs { display: flex; gap: 8px; margin-bottom: 24px; border-bottom: 1px solid var(--color-border); overflow-x: auto; }
        .nav-tab { padding: 12px 16px; border: none; background: none; cursor: pointer; color: var(--color-text-secondary); border-bottom: 2px solid transparent; white-space: nowrap; transition: all var(--duration); font-weight: 500; }
        .nav-tab:hover { color: var(--color-primary); }
        .nav-tab.active { color: var(--color-primary); border-bottom-color: var(--color-primary); }
        .content { display: none; }
        .content.active { display: block; animation: fadeIn 0.3s; }
        .tick-btn { width: 56px; height: 56px; border-radius: 50%; border: 3px solid var(--color-border); background: var(--color-surface); cursor: pointer; font-size: 28px; display: flex; align-items: center; justify-content: center; transition: all var(--duration); }
        .tick-btn:hover { border-color: var(--color-primary); }
        .tick-btn.done { background: var(--color-success); border-color: var(--color-success); color: white; animation: pulse 0.3s; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
        .habit-item { display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius); margin-bottom: 12px; transition: all var(--duration); }
        .habit-item:hover { box-shadow: var(--shadow-md); }
        .habit-name { font-weight: 600; font-size: 16px; margin-bottom: 4px; }
        .habit-meta { display: flex; gap: 12px; font-size: 13px; color: var(--color-text-secondary); flex-wrap: wrap; }
        .streak-badge { display: inline-flex; align-items: center; gap: 6px; background: var(--color-warning); color: white; padding: 6px 12px; border-radius: 20px; font-weight: 600; font-size: 12px; }
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin: 20px 0; }
        .calendar-day { padding: 10px; text-align: center; border: 1px solid var(--color-border); border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all var(--duration); }
        .calendar-day.done { background: var(--color-success); color: white; border-color: var(--color-success); }
        .calendar-day.future { background: var(--color-bg-secondary); color: var(--color-text-secondary); cursor: default; }
        .calendar-day:hover:not(.future) { background: var(--color-primary); color: white; border-color: var(--color-primary); }
        .progress-bar { width: 100%; height: 8px; background: var(--color-bg-secondary); border-radius: 4px; margin: 10px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--color-primary), var(--color-success)); transition: width 0.5s ease; }
        .login-container { display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .login-box { background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius); padding: 40px; max-width: 400px; width: 100%; box-shadow: var(--shadow-lg); }
        .empty-state { text-align: center; padding: 40px 20px; color: var(--color-text-secondary); }
        .empty-state-icon { font-size: 48px; margin-bottom: 16px; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .badge-success { background: rgba(16, 185, 129, 0.2); color: var(--color-success); }
        .badge-error { background: rgba(239, 68, 68, 0.2); color: var(--color-error); }
        .badge-warning { background: rgba(245, 158, 11, 0.2); color: var(--color-warning); }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; gap: 12px; }
            .habit-item { flex-direction: column; align-items: flex-start; }
            .modal-content { padding: 16px; }
            .login-box { padding: 24px; }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- LOGIN SCREEN -->
        <div id="loginScreen" class="login-container">
            <div class="login-box">
                <h1 style="text-align: center; margin-bottom: 8px; color: var(--color-primary);">üéØ HabitTick v7</h1>
                <p style="text-align: center; color: var(--color-text-secondary); margin-bottom: 24px; font-size: 14px;">Complete Habit Tracking + Goals + Calendar</p>
                
                <div style="display: flex; gap: 12px; margin-bottom: 16px; border-bottom: 1px solid var(--color-border);">
                    <button class="nav-tab active" id="userLoginTab" data-login="user" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent;">üë§ User</button>
                    <button class="nav-tab" id="adminLoginTab" data-login="admin" style="flex: 1; padding: 12px; border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent;">üëë Admin</button>
                </div>

                <!-- USER LOGIN -->
                <div id="userLoginPanel">
                    <div class="form-group">
                        <button class="btn btn-primary" id="googleSignInBtn" style="width: 100%;">üîê Demo Login (Click Here)</button>
                    </div>
                    <p style="font-size: 12px; color: var(--color-text-secondary); text-align: center;">Instant access ‚Ä¢ No registration required</p>
                </div>

                <!-- ADMIN LOGIN -->
                <div id="adminLoginPanel" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="adminEmail" class="form-input" placeholder="admin@example.com" value="admin@example.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="adminPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="admin123">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" id="adminLoginBtn" style="width: 100%;">Login as Admin</button>
                    </div>
                    <p style="font-size: 12px; color: var(--color-text-secondary); text-align: center;">Demo: admin@example.com / admin123</p>
                </div>
            </div>
        </div>

        <!-- USER APP -->
        <div id="userApp" style="display: none;">
            <header class="header">
                <div class="header-content container">
                    <div>
                        <h1 style="margin: 0; font-size: 24px;">üéØ HabitTick</h1>
                        <p style="margin: 0; font-size: 12px; color: var(--color-text-secondary);">v7 ‚Ä¢ Complete Habit Tracking</p>
                    </div>
                    <button class="btn btn-secondary btn-small" id="userSignOutBtn">Sign Out</button>
                </div>
            </header>

            <div class="container">
                <div class="nav-tabs">
                    <button class="nav-tab active" data-tab="dashboard">üìä Dashboard</button>
                    <button class="nav-tab" data-tab="habits">üéØ My Habits</button>
                    <button class="nav-tab" data-tab="goals">üèÜ Goals</button>
                    <button class="nav-tab" data-tab="analytics">üìà Analytics</button>
                </div>
            </div>

            <!-- ADMIN PANEL -->
            <div id="adminPanel" style="display: none; background: rgba(124, 58, 237, 0.05); padding: 16px 0; border-bottom: 2px solid var(--color-admin);">
                <div class="container">
                    <div class="nav-tabs" style="margin-bottom: 0;">
                        <button class="nav-tab active" data-admin-tab="dashboard" style="color: var(--color-admin);">üëë Admin Dashboard</button>
                        <button class="nav-tab" data-admin-tab="users">üë• Users</button>
                        <button class="nav-tab" data-admin-tab="logs">üìã Logs</button>
                    </div>
                </div>
            </div>

            <main style="padding: 24px 0; flex: 1;">
                <div class="container">
                    <!-- DASHBOARD -->
                    <div id="dashboard" class="content active">
                        <div class="grid" style="margin-bottom: 24px;">
                            <div class="stat-card">
                                <div class="stat-label">üìä Today's Progress</div>
                                <div class="stat-value" id="todayProgress">0%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">üî• Current Streak</div>
                                <div class="stat-value" id="currentStreak">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">‚≠ê Best Streak</div>
                                <div class="stat-value" id="bestStreak">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">üéØ Total Habits</div>
                                <div class="stat-value" id="totalHabits">0</div>
                            </div>
                        </div>

                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="margin: 0; font-size: 18px;">üìã Today's Habits</h3>
                                <button class="btn btn-primary btn-small" id="createHabitBtn">+ New Habit</button>
                            </div>
                            <div id="todayHabitsList"></div>
                        </div>
                    </div>

                    <!-- MY HABITS -->
                    <div id="habits" class="content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <h2 style="margin: 0;">All Habits</h2>
                            <button class="btn btn-primary" id="addHabitBtn">+ Create Habit</button>
                        </div>
                        <div id="habitsList"></div>
                    </div>

                    <!-- GOALS -->
                    <div id="goals" class="content">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <h2 style="margin: 0;">Goals & Targets</h2>
                            <button class="btn btn-primary" id="addGoalBtn">+ Add Goal</button>
                        </div>
                        <div id="goalsList"></div>
                    </div>

                    <!-- ANALYTICS -->
                    <div id="analytics" class="content">
                        <h2 style="margin-bottom: 24px;">üìà Analytics & Insights</h2>
                        <div id="analyticsContent"></div>
                    </div>

                    <!-- ADMIN DASHBOARD -->
                    <div id="adminDashboardContent" style="display: none;">
                        <h2 style="margin-bottom: 24px; color: var(--color-admin);">üëë Admin Dashboard</h2>
                        <div class="grid" style="margin-bottom: 24px;">
                            <div class="stat-card">
                                <div class="stat-label">üë• Total Users</div>
                                <div class="stat-value" id="totalUsers" style="color: var(--color-admin);">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">üéØ Active Habits</div>
                                <div class="stat-value" id="activeHabits" style="color: var(--color-admin);">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">üèÜ Total Goals</div>
                                <div class="stat-value" id="totalGoals" style="color: var(--color-admin);">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">‚úì System Status</div>
                                <div class="stat-value" style="color: var(--color-success);">‚úì Active</div>
                            </div>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 16px;">üìä Recent Activity</h3>
                            <div id="adminActivityLog"></div>
                        </div>
                    </div>

                    <!-- ADMIN USERS -->
                    <div id="adminUsersContent" style="display: none;">
                        <h2 style="margin-bottom: 24px; color: var(--color-admin);">üë• User Management</h2>
                        <input type="text" id="userSearch" class="form-input" placeholder="Search users..." style="margin-bottom: 16px;">
                        <div id="adminUsersList"></div>
                    </div>

                    <!-- ADMIN LOGS -->
                    <div id="adminLogsContent" style="display: none;">
                        <h2 style="margin-bottom: 24px; color: var(--color-admin);">üìã Activity Logs</h2>
                        <div id="adminLogsList" class="card"></div>
                    </div>
                </div>
            </main>

            <!-- HABIT MODAL -->
            <div id="habitModal" class="modal">
                <div class="modal-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="margin: 0;" id="habitModalTitle">Create New Habit</h3>
                        <button style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-secondary);" id="habitModalClose">&times;</button>
                    </div>
                    <form id="habitForm">
                        <div class="form-group">
                            <label class="form-label">Habit Name</label>
                            <input type="text" id="habitName" class="form-input" placeholder="e.g., Morning Run" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select id="habitCategory" class="form-input" required>
                                <option value="">Select Category</option>
                                <option value="health">üè• Health</option>
                                <option value="fitness">üí™ Fitness</option>
                                <option value="work">üíº Work</option>
                                <option value="study">üìö Study</option>
                                <option value="mindfulness">üßò Mindfulness</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duration (minutes)</label>
                            <input type="number" id="habitDuration" class="form-input" placeholder="30" min="1" required>
                        </div>
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" id="habitFormCancel">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Habit</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- GOAL MODAL -->
            <div id="goalModal" class="modal">
                <div class="modal-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="margin: 0;">Set Goal</h3>
                        <button style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-secondary);" id="goalModalClose">&times;</button>
                    </div>
                    <form id="goalForm">
                        <div class="form-group">
                            <label class="form-label">Select Habit</label>
                            <select id="goalHabit" class="form-input" required></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Goal Type</label>
                            <select id="goalType" class="form-input" required>
                                <option value="weekly">Weekly (days per week)</option>
                                <option value="monthly">Monthly (days per month)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Target Days</label>
                            <input type="number" id="goalTarget" class="form-input" placeholder="e.g., 5" min="1" required>
                        </div>
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button type="button" class="btn btn-secondary" id="goalFormCancel">Cancel</button>
                            <button type="submit" class="btn btn-primary">Create Goal</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- CALENDAR MODAL -->
            <div id="calendarModal" class="modal">
                <div class="modal-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="margin: 0;" id="calendarTitle">Calendar</h3>
                        <button style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-secondary);" id="calendarModalClose">&times;</button>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 16px; justify-content: space-between; align-items: center;">
                        <button class="btn btn-secondary btn-small" id="prevMonth">‚Üê Prev</button>
                        <span id="monthYearDisplay" style="font-weight: 600; min-width: 150px; text-align: center;"></span>
                        <button class="btn btn-secondary btn-small" id="nextMonth">Next ‚Üí</button>
                    </div>
                    <div id="calendarGrid" class="calendar"></div>
                    <p style="font-size: 12px; color: var(--color-text-secondary); text-align: center; margin-top: 16px;">
                        üü¢ Done | ‚¨ú Not Done | ‚ö™ Future
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const APP = {
            currentUser: null,
            habits: [],
            habitLogs: [],
            goals: [],
            currentHabitId: null,
            currentMonth: new Date(),
            isAdmin: false
        };

        const CATEGORIES = {
            health: 'üè•',
            fitness: 'üí™',
            work: 'üíº',
            study: 'üìö',
            mindfulness: 'üßò'
        };

        document.addEventListener('DOMContentLoaded', () => {
            setupLoginListeners();
            const savedUser = localStorage.getItem('currentUser');
            const savedAdmin = localStorage.getItem('currentAdmin');
            
            if (savedAdmin) {
                APP.isAdmin = true;
                showAdminPanel();
            } else if (savedUser) {
                APP.currentUser = JSON.parse(savedUser);
                loadUserData();
                showUserApp();
            } else {
                showLoginScreen();
            }
        });

        function setupLoginListeners() {
            // Login Tab Switch
            document.getElementById('userLoginTab').addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('[data-login]').forEach(t => t.classList.remove('active'));
                document.getElementById('userLoginTab').classList.add('active');
                document.getElementById('userLoginPanel').style.display = 'block';
                document.getElementById('adminLoginPanel').style.display = 'none';
            });

            document.getElementById('adminLoginTab').addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('[data-login]').forEach(t => t.classList.remove('active'));
                document.getElementById('adminLoginTab').classList.add('active');
                document.getElementById('userLoginPanel').style.display = 'none';
                document.getElementById('adminLoginPanel').style.display = 'block';
            });

            // User Login
            document.getElementById('googleSignInBtn').addEventListener('click', (e) => {
                e.preventDefault();
                APP.currentUser = {
                    id: 'user_' + Date.now(),
                    email: 'user_' + Math.random().toString(36).substr(2, 9) + '@example.com',
                    createdAt: new Date().toISOString()
                };
                APP.isAdmin = false;
                localStorage.setItem('currentUser', JSON.stringify(APP.currentUser));
                localStorage.removeItem('currentAdmin');
                showUserApp();
            });

            // Admin Login
            const adminLoginBtn = document.getElementById('adminLoginBtn');
            if (adminLoginBtn) {
                adminLoginBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const email = document.getElementById('adminEmail').value.trim();
                    const password = document.getElementById('adminPassword').value.trim();
                    
                    if (email === 'admin@example.com' && password === 'admin123') {
                        APP.isAdmin = true;
                        localStorage.setItem('currentAdmin', 'admin_' + Date.now());
                        localStorage.removeItem('currentUser');
                        showAdminPanel();
                    } else {
                        alert('‚ùå Invalid credentials!\n\nCorrect credentials:\nEmail: admin@example.com\nPassword: admin123');
                    }
                });
            }

            document.getElementById('userSignOutBtn').addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('currentUser');
                localStorage.removeItem('currentAdmin');
                APP.currentUser = null;
                APP.isAdmin = false;
                showLoginScreen();
            });

            // User Navigation
            document.querySelectorAll('.nav-tab[data-tab]').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const tabName = e.target.getAttribute('data-tab');
                    if (tabName) {
                        document.querySelectorAll('.nav-tab[data-tab]').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('[id="dashboard"], [id="habits"], [id="goals"], [id="analytics"]').forEach(c => c.classList.remove('active'));
                        e.target.classList.add('active');
                        document.getElementById(tabName).classList.add('active');
                        if (tabName === 'analytics') renderAnalytics();
                    }
                });
            });

            // Habit Modal
            document.getElementById('createHabitBtn').addEventListener('click', openHabitModal);
            document.getElementById('addHabitBtn').addEventListener('click', openHabitModal);
            document.getElementById('habitModalClose').addEventListener('click', closeHabitModal);
            document.getElementById('habitFormCancel').addEventListener('click', closeHabitModal);
            document.getElementById('habitForm').addEventListener('submit', submitHabit);

            // Goal Modal
            document.getElementById('addGoalBtn').addEventListener('click', openGoalModal);
            document.getElementById('goalModalClose').addEventListener('click', closeGoalModal);
            document.getElementById('goalFormCancel').addEventListener('click', closeGoalModal);
            document.getElementById('goalForm').addEventListener('submit', submitGoal);

            // Calendar Modal
            document.getElementById('calendarModalClose').addEventListener('click', closeCalendarModal);
            document.getElementById('prevMonth').addEventListener('click', () => {
                APP.currentMonth.setMonth(APP.currentMonth.getMonth() - 1);
                renderCalendar();
            });
            document.getElementById('nextMonth').addEventListener('click', () => {
                APP.currentMonth.setMonth(APP.currentMonth.getMonth() + 1);
                renderCalendar();
            });
        }

        function loadUserData() {
            const saved = localStorage.getItem(`user_${APP.currentUser.id}_data`);
            if (saved) {
                const data = JSON.parse(saved);
                APP.habits = data.habits || [];
                APP.habitLogs = data.habitLogs || [];
                APP.goals = data.goals || [];
            }
        }

        function saveUserData() {
            localStorage.setItem(`user_${APP.currentUser.id}_data`, JSON.stringify({
                habits: APP.habits,
                habitLogs: APP.habitLogs,
                goals: APP.goals
            }));
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('userApp').style.display = 'none';
        }

        function showUserApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('userApp').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            renderDashboard();
        }

        function showAdminPanel() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('userApp').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'block';

            // Admin Tabs
            document.querySelectorAll('[data-admin-tab]').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabName = e.target.getAttribute('data-admin-tab');
                    document.querySelectorAll('[data-admin-tab]').forEach(t => t.classList.remove('active'));
                    document.getElementById('adminDashboardContent').style.display = 'none';
                    document.getElementById('adminUsersContent').style.display = 'none';
                    document.getElementById('adminLogsContent').style.display = 'none';
                    e.target.classList.add('active');
                    document.getElementById('admin' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Content').style.display = 'block';
                });
            });

            renderAdminDashboard();

            const header = document.querySelector('.header-content');
            const signOutBtn = document.querySelector('#userSignOutBtn');
            if (signOutBtn) {
                signOutBtn.remove();
            }
            
            const adminSignOut = document.createElement('button');
            adminSignOut.className = 'btn btn-secondary btn-small';
            adminSignOut.textContent = 'Sign Out';
            adminSignOut.id = 'adminSignOut';
            adminSignOut.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('currentAdmin');
                localStorage.removeItem('currentUser');
                APP.isAdmin = false;
                showLoginScreen();
            });
            header.appendChild(adminSignOut);

            header.querySelector('h1').textContent = 'üëë Admin Panel';
        }

        function renderAdminDashboard() {
            document.getElementById('totalUsers').textContent = '2+';
            document.getElementById('activeHabits').textContent = APP.habits.length;
            document.getElementById('totalGoals').textContent = APP.goals.length;

            let logContent = '<div style="font-size: 13px; line-height: 2;">';
            if (APP.habitLogs.length === 0) {
                logContent += '<p style="color: var(--color-text-secondary);">No activity yet</p>';
            } else {
                APP.habitLogs.slice(-5).reverse().forEach(log => {
                    logContent += `<p style="margin: 4px 0;">‚úì Habit logged on ${log.date}</p>`;
                });
            }
            logContent += '</div>';
            document.getElementById('adminActivityLog').innerHTML = logContent;

            const usersList = document.getElementById('adminUsersList');
            const demoUsers = [
                { id: 'user_1', email: 'demo.user@example.com', habits: APP.habits.length, created: '2026-01-01' },
                { id: 'user_2', email: 'john.doe@example.com', habits: Math.max(0, APP.habits.length - 1), created: '2025-12-15' }
            ];

            let usersHtml = '<div style="display: flex; flex-direction: column; gap: 12px;">';
            demoUsers.forEach(user => {
                usersHtml += `
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4 style="margin: 0 0 4px 0;">${user.email}</h4>
                                <p style="margin: 0; font-size: 12px; color: var(--color-text-secondary);">
                                    ${user.habits} habits ‚Ä¢ Created ${user.created}
                                </p>
                            </div>
                            <button class="btn btn-secondary btn-small">View</button>
                        </div>
                    </div>
                `;
            });
            usersHtml += '</div>';
            usersList.innerHTML = usersHtml;

            const logsList = document.getElementById('adminLogsList');
            let logsHtml = '<table style="width: 100%; font-size: 13px; line-height: 2.2;"><thead style="border-bottom: 2px solid var(--color-border);"><tr><th style="text-align: left; padding: 8px 0;">Date</th><th style="text-align: left; padding: 8px 0;">Action</th><th style="text-align: left; padding: 8px 0;">Status</th></tr></thead><tbody>';
            if (APP.habitLogs.length === 0) {
                logsHtml += '<tr><td style="color: var(--color-text-secondary); padding: 16px 0;">No logs available</td></tr>';
            } else {
                APP.habitLogs.slice(-10).reverse().forEach(log => {
                    logsHtml += `<tr style="border-bottom: 1px solid var(--color-border);"><td style="padding: 8px 0;">${log.date}</td><td>Habit Completed</td><td style="color: var(--color-success);">‚úì</td></tr>`;
                });
            }
            logsHtml += '</tbody></table>';
            logsList.innerHTML = logsHtml;
        }

        function openHabitModal() {
            APP.currentHabitId = null;
            document.getElementById('habitModalTitle').textContent = 'Create New Habit';
            document.getElementById('habitForm').reset();
            document.getElementById('habitModal').classList.add('active');
        }

        function closeHabitModal() {
            document.getElementById('habitModal').classList.remove('active');
        }

        function submitHabit(e) {
            e.preventDefault();
            const name = document.getElementById('habitName').value;
            const category = document.getElementById('habitCategory').value;
            const duration = parseInt(document.getElementById('habitDuration').value);

            const habit = {
                id: 'habit_' + Date.now(),
                name,
                category,
                duration,
                createdAt: new Date().toISOString()
            };

            APP.habits.push(habit);
            saveUserData();
            closeHabitModal();
            renderDashboard();
            renderHabits();
            updateGoalSelect();
        }

        function openGoalModal() {
            if (APP.habits.length === 0) {
                alert('‚ùå Please create a habit first!');
                return;
            }
            document.getElementById('goalModal').classList.add('active');
            updateGoalSelect();
        }

        function closeGoalModal() {
            document.getElementById('goalModal').classList.remove('active');
        }

        function updateGoalSelect() {
            const select = document.getElementById('goalHabit');
            select.innerHTML = '<option value="">Select Habit</option>';
            APP.habits.forEach(habit => {
                select.innerHTML += `<option value="${habit.id}">${CATEGORIES[habit.category]} ${habit.name}</option>`;
            });
        }

        function submitGoal(e) {
            e.preventDefault();
            const habitId = document.getElementById('goalHabit').value;
            const type = document.getElementById('goalType').value;
            const target = parseInt(document.getElementById('goalTarget').value);

            const goal = {
                id: 'goal_' + Date.now(),
                habitId,
                type,
                target,
                createdAt: new Date().toISOString()
            };

            APP.goals.push(goal);
            saveUserData();
            closeGoalModal();
            renderGoals();
            document.getElementById('goalForm').reset();
        }

        function renderDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayCompleted = APP.habitLogs.filter(l => l.date === today && l.status === 1).length;
            const totalHabits = APP.habits.length;

            document.getElementById('totalHabits').textContent = totalHabits;
            document.getElementById('todayProgress').textContent = totalHabits > 0 ? Math.round((todayCompleted / totalHabits) * 100) + '%' : '0%';

            let maxStreak = 0;
            let currentStreak = 0;
            APP.habits.forEach(habit => {
                const streak = calculateStreak(habit.id);
                maxStreak = Math.max(maxStreak, streak.longest);
                currentStreak = Math.max(currentStreak, streak.current);
            });

            document.getElementById('currentStreak').textContent = currentStreak;
            document.getElementById('bestStreak').textContent = maxStreak;

            renderTodayHabits();
        }

        function renderTodayHabits() {
            const today = new Date().toISOString().split('T')[0];
            const container = document.getElementById('todayHabitsList');

            if (APP.habits.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><div>No habits yet. Create one to get started!</div></div>';
                return;
            }

            container.innerHTML = APP.habits.map(habit => {
                const log = APP.habitLogs.find(l => l.habitId === habit.id && l.date === today);
                const isDone = log && log.status === 1;
                const streak = calculateStreak(habit.id);

                return `
                    <div class="habit-item">
                        <div>
                            <div class="habit-name">${CATEGORIES[habit.category]} ${habit.name}</div>
                            <span class="streak-badge">üî• ${streak.current} days</span>
                        </div>
                        <button class="tick-btn ${isDone ? 'done' : ''}" onclick="toggleHabit('${habit.id}', '${today}')">
                            ${isDone ? '‚úì' : ''}
                        </button>
                    </div>
                `;
            }).join('');
        }

        function renderHabits() {
            const container = document.getElementById('habitsList');

            if (APP.habits.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üéØ</div><div>Create your first habit!</div></div>';
                return;
            }

            container.innerHTML = APP.habits.map(habit => {
                const streak = calculateStreak(habit.id);
                const totalDone = APP.habitLogs.filter(l => l.habitId === habit.id && l.status === 1).length;

                return `
                    <div class="card" style="margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div style="flex: 1;">
                                <h4 style="margin: 0; margin-bottom: 8px;">${CATEGORIES[habit.category]} ${habit.name}</h4>
                                <div class="habit-meta">
                                    <span>‚è±Ô∏è ${habit.duration}min</span>
                                    <span>üî• ${streak.current} day streak</span>
                                    <span>‚úì ${totalDone} completions</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary btn-small" onclick="openCalendarForHabit('${habit.id}')">üìÖ Calendar</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderGoals() {
            const container = document.getElementById('goalsList');

            if (APP.goals.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üèÜ</div><div>No goals yet. Create one!</div></div>';
                return;
            }

            container.innerHTML = APP.goals.map(goal => {
                const habit = APP.habits.find(h => h.id === goal.habitId);
                if (!habit) return '';

                const period = goal.type === 'weekly' ? 7 : 30;
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - period);

                const completed = APP.habitLogs.filter(l => 
                    l.habitId === goal.habitId && 
                    l.status === 1 && 
                    new Date(l.date) >= startDate
                ).length;

                const progress = Math.min(100, (completed / goal.target) * 100);

                return `
                    <div class="card" style="margin-bottom: 12px;">
                        <h4 style="margin: 0 0 8px 0;">${CATEGORIES[habit.category]} ${habit.name}</h4>
                        <p style="margin: 0 0 8px 0; font-size: 14px; color: var(--color-text-secondary);">
                            ${goal.type === 'weekly' ? 'üìÖ Weekly' : 'üìÖ Monthly'} Goal: ${completed}/${goal.target} days
                        </p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <p style="margin: 8px 0 0 0; font-size: 12px; color: var(--color-text-secondary);">
                            ${Math.round(progress)}% Complete ${completed >= goal.target ? '‚úÖ' : ''}
                        </p>
                    </div>
                `;
            }).join('');
        }

        function renderAnalytics() {
            const container = document.getElementById('analyticsContent');
            const total = APP.habitLogs.filter(l => l.status === 1).length;
            const thisWeek = APP.habitLogs.filter(l => {
                const d = new Date(l.date);
                const now = new Date();
                const diff = now - d;
                return l.status === 1 && diff < 7 * 24 * 60 * 60 * 1000;
            }).length;

            container.innerHTML = `
                <div class="grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-label">üìä Total Completions</div>
                        <div class="stat-value">${total}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üìà This Week</div>
                        <div class="stat-value">${thisWeek}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üèÜ Active Goals</div>
                        <div class="stat-value">${APP.goals.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üéØ Total Habits</div>
                        <div class="stat-value">${APP.habits.length}</div>
                    </div>
                </div>
            `;
        }

        function toggleHabit(habitId, date) {
            let log = APP.habitLogs.find(l => l.habitId === habitId && l.date === date);

            if (log) {
                log.status = log.status === 1 ? 0 : 1;
            } else {
                log = { habitId, date, status: 1 };
                APP.habitLogs.push(log);
            }

            saveUserData();
            renderDashboard();
        }

        function calculateStreak(habitId) {
            const logs = APP.habitLogs.filter(l => l.habitId === habitId && l.status === 1).sort((a, b) => new Date(a.date) - new Date(b.date));
            let current = 0, longest = 0, temp = 0;

            const today = new Date();
            let checkDate = new Date();

            for (let i = 365; i >= 0; i--) {
                const dateStr = checkDate.toISOString().split('T')[0];
                const log = logs.find(l => l.date === dateStr);

                if (log) {
                    temp++;
                    longest = Math.max(longest, temp);
                } else {
                    temp = 0;
                }

                checkDate.setDate(checkDate.getDate() - 1);
            }

            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            const todayStr = today.toISOString().split('T')[0];

            const todayLog = logs.find(l => l.date === todayStr);
            const yesterdayLog = logs.find(l => l.date === yesterdayStr);

            if (todayLog) current = temp;
            else if (yesterdayLog) current = temp - 1;

            return { current, longest };
        }

        function openCalendarForHabit(habitId) {
            APP.currentHabitId = habitId;
            const habit = APP.habits.find(h => h.id === habitId);
            document.getElementById('calendarTitle').textContent = `üìÖ ${habit.name}`;
            APP.currentMonth = new Date();
            renderCalendar();
            document.getElementById('calendarModal').classList.add('active');
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').classList.remove('active');
        }

        function renderCalendar() {
            const year = APP.currentMonth.getFullYear();
            const month = APP.currentMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();

            document.getElementById('monthYearDisplay').textContent = APP.currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekDays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.style.fontWeight = '600';
                dayHeader.style.textAlign = 'center';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });

            for (let i = 0; i < firstDay.getDay(); i++) {
                grid.appendChild(document.createElement('div'));
            }

            const today = new Date().toISOString().split('T')[0];

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const log = APP.habitLogs.find(l => l.habitId === APP.currentHabitId && l.date === dateStr);
                const isDone = log && log.status === 1;
                const isFuture = dateStr > today;

                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                if (isDone) dayEl.classList.add('done');
                if (isFuture) dayEl.classList.add('future');

                dayEl.textContent = isDone ? '‚úì' : day;

                if (!isFuture) {
                    dayEl.addEventListener('click', () => {
                        toggleHabit(APP.currentHabitId, dateStr);
                        renderCalendar();
                    });
                }

                grid.appendChild(dayEl);
            }
        }
    </script>
</body>
</html>
